<!DOCTYPE html>
<html>
<head>
    <title>Meal Creation Assistant</title>
    <!-- Include Bootstrap CSS and JavaScript files -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
        /* Center the table */
        .container {
            max-width: 70%; /* Adjust the maximum width as a percentage of the viewport width */
            margin: 0 auto; /* Center the container horizontally */
            padding: 20px; /* Add some padding for spacing */
            box-sizing: border-box; /* Include padding in the width calculation */
        }

        /*
        @media (min-width: 768px){
        .container, .container-md, .container-sm {
            max-width: 100%;
        }
        */

        .row {
            margin-right: 0;
            margin-left: 0;
        }


        /* Make the table width responsive */
        .table-responsive {
            width: 100%;
            height: 100%;
            overflow-x: auto;
        }

        /* Style the table header */
        .thead-dark {
            background-color: #343a40;
            color: #fff;
        }

        /* Style the table rows */
        .table td,
        .table th {
            border: none;
        }

        .table tbody tr:nth-of-type(odd) {
            background-color: #f9f9f9;
        }

        .table tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Style the checkboxes */
        input[type="checkbox"] {
            transform: scale(1.5);
        }

        .item_name {
            cursor: help;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="table-responsive">
        <h1 class="text-center">GÃ©rer mon frigo virtuel</h1>
        <table class="table table-striped" id="my-table">
            <thead>
            <tr>
                <th></th>
                <th class="item_name" title="Click on item name to copy the barcode">Name</th>
                <th>Quantity</th>
                <th>Calories</th>
                <th>Proteins</th>
                <th>Fats</th>
                <th>Carbs</th>
                <th>Sugars</th>
            </tr>
            </thead>
            <tbody>

            {% for item in items %}
                <tr>
                    <td><label>
                        <input type="number" name="quantity" value="0" min="0" max="100">
                    </label></td>
                    <td style="display: none">{{ item.barcode }}</td>
                    <td title="{{ item.barcode }}">{{ item.name }}</td>
                    <td>{{ item.quantity }}{{ item.measure }}</td>
                    <td>{{ item.calories }}</td>
                    <td>{{ item.proteins }}</td>
                    <td>{{ item.fats }}</td>
                    <td>{{ item.carbohydrates }}</td>
                    <td>{{ item.sugars }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="text-center mt-3">
            <a href="{{ url_for('scan') }}" class="btn btn-primary">Scan New Item</a>
        </div>
    </div>
</div>
</body>
</html>


<script>

    function getTableData() {
        var table = document.getElementById('my-table');
        var data = [];
        for (var i = 1; i < table.rows.length; i++) {
            var checkbox = table.rows[i].cells[0].querySelector('input[type="number"]');
            var id = table.rows[i].cells[1].textContent;
            if (checkbox.value > 0) {
                data.push({
                    number: checkbox.value,
                    id: id,
                });
            }
        }
        return data;
    }

    // When i click on a row, the barcode is copied to the clipboard
    document.addEventListener('click', function (event) {
        var isClickInside = document.getElementById("my-table").contains(event.target);
        if (isClickInside) {
            var clickedElement = event.target;
            if (clickedElement.tagName === 'TD') {
                var barcode = clickedElement.title;
                navigator.clipboard.writeText(barcode);
                alert("Barcode copied to clipboard")
            }
        }
    }, false);


</script>